@startuml Activity_ConnexionDeconnexion
title Diagramme d'activite : Se connecter / Se deconnecter

start

:Membre accede a la page de connexion;

:Afficher formulaire\n(email, mot de passe);

:Membre saisit identifiants et soumet;

:Controller recoit POST /login;

:Rechercher utilisateur par email\nSELECT user_id, username, email,\npassword, role, is_active\nFROM user_account\nWHERE email = ? AND deleted_at IS NULL;

if (Utilisateur trouve ?) then (non)
  :Renvoyer 401 "Identifiants invalides";
  :Afficher erreur;
  stop
else (oui)
  if (Compte actif (is_active) ?) then (non)
    :Renvoyer 403 "compte desactive";
    :Afficher message de blocage;
    stop
  else (oui)
    :Comparer mot de passe\navec bcrypt.compare();

    if (Mot de passe correct ?) then (non)
      :Renvoyer 401 "Identifiants invalides";
      :Afficher erreur;
      stop
    else (oui)
      :Generer token JWT\n(user_id, role, expiration);

      :Renvoyer 200 + token + user_account data;

      :Stocker token JWT cote client;
      :Rediriger vers espace personnel;

      stop
    endif
  endif
endif

@enduml

@startuml Activity_Deconnexion
title Diagramme d'activite : Se deconnecter

start

:Membre clique sur "Se deconnecter";

:Front envoie POST /logout + token JWT;

:Controller recoit la demande;

:Supprimer token cote client\n(localStorage ou cookie);

:Renvoyer 204 No Content;

:Supprimer token local;

:Rediriger vers page d'accueil;

stop

@enduml
