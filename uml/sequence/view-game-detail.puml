@startuml Feature_ConsulterFicheJeu_Sequence
title Feature: Consulter la fiche d'un jeu (sequence)
actor Visiteur
participant "Front Web" as Front
participant "Route" as Route
participant "Controller" as Controller
participant "Model" as Model
database "Base de donnees" as BDD

Visiteur -> Front: Cliquer sur un jeu
Front -> Route: GET /games/:slug
Route -> Controller: gameController.getGameDetail(req, res)

note right of Controller
  Optimisation: Une seule requête via
  la vue view_game_complete_details
  au lieu de 6-8 requêtes séquentielles
end note

Controller -> Model: gameModel.getCompleteGameDetailsBySlug(slug)
Model -> BDD: SELECT * FROM view_game_complete_details\nWHERE slug = ?
note right of BDD
  Cette vue regroupe via des JOINs:
  - Infos du jeu (title, slug, cover, etc.)
  - Plateformes (JSON array)
  - Genres (JSON array)
  - Tags (JSON array)
  - Développeurs (JSON array)
  - Éditeurs (JSON array)
  - Statistiques (avg_rating, count)
end note
BDD --> Model: Fiche complete (1 requete)
Model --> Controller: Toutes les donnees du jeu

alt Jeu non trouve
Controller --> Route: 404 + "Jeu non trouve"
Route --> Front: 404 + message
Front --> Visiteur: Afficher erreur 404
else Jeu trouve
Controller -> Model: commentModel.getGameComments(game_id, limit: 5)
Model -> BDD: SELECT comment_id, content,\ncreated_at, author_username, author_avatar\nFROM view_comment_with_author\nWHERE game_id = ?\nORDER BY created_at DESC\nLIMIT 5
note right of BDD
  Vue view_comment_with_author
  filtre automatiquement les soft deletes
end note
BDD --> Model: Derniers commentaires
Model --> Controller: Liste commentaires

Controller --> Route: 200 + fiche complete
Route --> Front: 200 + toutes les donnees
Front --> Visiteur: Afficher fiche complete du jeu
end

alt Erreur BDD
Model --> Controller: Erreur BDD
Controller --> Route: 500 + message
Route --> Front: 500 + message
Front --> Visiteur: Afficher message d'erreur
end
@enduml
